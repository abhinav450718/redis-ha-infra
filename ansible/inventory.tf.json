output "ansible_inventory" {
  value = jsonencode({
    bastion = {
      hosts = {
        "${module.bastion.bastion_public_ip}" = {
          ansible_user               = "ubuntu"
          ansible_ssh_private_key_file = "${path.root}/redis_key.pem"
        }
      }
    }
    redis_master = {
      hosts = {
        "${module.redis_master.private_ip}" = {
          ansible_user               = "ubuntu"
          ansible_ssh_private_key_file = "${path.root}/redis_key.pem"
          ansible_ssh_common_args   = "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o ProxyCommand='ssh -i ${path.root}/redis_key.pem -W %h:%p ubuntu@${module.bastion.bastion_public_ip}'"
        }
      }
    }
    redis_replica = {
      hosts = {
        "${module.redis_replica.private_ip}" = {
          ansible_user               = "ubuntu"
          ansible_ssh_private_key_file = "${path.root}/redis_key.pem"
          ansible_ssh_common_args   = "-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o ProxyCommand='ssh -i ${path.root}/redis_key.pem -W %h:%p ubuntu@${module.bastion.bastion_public_ip}'"
        }
      }
    }
  })
}
